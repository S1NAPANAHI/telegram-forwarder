# راهنمای استقرار و تست

این راهنما دستورالعمل‌های گام به گام برای استقرار و تست اپلیکیشن ربات کلمات کلیدی تلگرام را ارائه می‌دهد.

## ۱. پیش‌نیازها

قبل از شروع، اطمینان حاصل کنید که موارد زیر روی سیستم شما نصب شده باشند:

- **داکر:** [دریافت داکر](https://docs.docker.com/get-docker/)
- **داکر کامپوز:** [نصب داکر کامپوز](https://docs.docker.com/compose/install/)

## ۲. پیکربندی

اپلیکیشن از یک فایل `.env` برای پیکربندی استفاده می‌کند. این فایل حاوی اطلاعات حساس است و **هرگز** نباید در سیستم کنترل نسخه (version control) ثبت شود.

۱. **ایجاد فایل `.env`:** در پوشه اصلی پروژه، یک فایل به نام `.env` ایجاد کنید.

۲. **افزودن متغیرها:** محتویات فایل `.env.example` (در صورت وجود) را کپی کرده یا از الگوی زیر استفاده کنید و اطلاعات واقعی خود را وارد نمایید:

    ```
    # پایگاه داده
    MONGODB_URI=mongodb://mongodb:27017/newsmonitor
    REDIS_URL=redis://redis:6379

    # تلگرام
    TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here

    # ایتا (در صورت استفاده از API غیررسمی)
    EITAA_PHONE=your_phone_number
    EITAA_PASSWORD=your_password

    # OpenAI
    OPENAI_API_KEY=your_openai_api_key

    # JWT
    JWT_SECRET=your_jwt_secret_key
    JWT_EXPIRES_IN=7d

    # سرور
    PORT=5000
    NODE_ENV=production

    # محدودیت نرخ درخواست
    RATE_LIMIT_WINDOW_MS=900000
    RATE_LIMIT_MAX_REQUESTS=100
    ```

## ۳. استقرار

اپلیکیشن با استفاده از داکر کامپوز استقرار می‌یابد که سرویس‌های فرانت‌اند، بک‌اند، پایگاه داده و سایر سرویس‌ها را مدیریت می‌کند.

۱. **یک ترمینال باز کنید** در پوشه اصلی پروژه.

۲. **ساخت و اجرای سرویس‌ها:** دستور زیر را اجرا کنید:

    ```bash
    docker-compose up --build -d
    ```

    - `--build`: این پرچم داکر را مجبور به ساخت مجدد ایمیج‌ها می‌کند.
    - `-d`: این پرچم کانتینرها را در حالت جدا شده (در پس‌زمینه) اجرا می‌کند.

۳. **دسترسی به اپلیکیشن:**
    - فرانت‌اند در آدرس [http://localhost:80](http://localhost:80) در دسترس خواهد بود.
    - API بک‌اند در آدرس [http://localhost:5000](http://localhost:5000) در دسترس خواهد بود.

۴. **برای متوقف کردن اپلیکیشن:** دستور زیر را اجرا کنید:

    ```bash
    docker-compose down
    ```

## ۴. تست

### ورود به ایتا

هنگامی که برای اولین بار یک کانال ایتا را مانیتور می‌کنید، باید به صورت دستی کد تأیید را وارد کنید. لطفاً برای دستورالعمل‌های دقیق به [راهنمای ورود به ایتا](./Eitaa_Login_Guide.md) مراجعه کنید.

### تست‌های بک‌اند

یک فایل تست نمونه در `backend/test.js` ارائه شده است. برای اجرای تست‌ها:

۱. **وارد کانتینر بک‌اند شوید:**

    ```bash
    docker-compose exec backend sh
    ```

۲. **فایل تست را اجرا کنید:**

    ```bash
    node test.js
    ```

بسیار توصیه می‌شود که مجموعه تست را با تست‌های واحد و یکپارچه‌سازی جامع‌تر گسترش دهید.

### چک‌لیست تست دستی

پس از استقرار اپلیکیشن، بررسی‌های زیر را انجام دهید تا از صحت عملکرد همه چیز اطمینان حاصل کنید:

- [ ] **ثبت نام کاربر:** آیا می‌توانید یک حساب کاربری جدید ایجاد کنید؟
- [ ] **ورود کاربر:** آیا می‌توانید با حساب کاربری جدید وارد شوید؟
- [ ] **داشبورد:** آیا داشبورد به درستی بارگذاری می‌شود و آمار جدید را نمایش می‌دهد؟
- [ ] **مدیریت کلمات کلیدی:** آیا می‌توانید کلمات کلیدی را اضافه و حذف کنید؟
- [ ] **مدیریت کانال:** آیا می‌توانید یک کانال جدید برای مانیتور کردن اضافه کنید؟
- [ ] **مدیریت مقاصد:** آیا می‌توانید یک مقصد برای ارسال پیام‌ها اضافه کنید؟
- [ ] **مانیتورینگ:** مانیتورینگ یک کانال را شروع کنید. آیا وضعیت به درستی به‌روز می‌شود؟
- [ ] **ارسال پیام:** در کانال مانیتور شده پیامی ارسال کنید که حاوی یکی از کلمات کلیدی شما باشد. آیا پیام به مقصد شما ارسال می‌شود؟
- [ ] **گزارش‌ها:** آیا پیام ارسال شده در صفحه گزارش‌ها و فید فعالیت‌های اخیر در داشبورد ظاهر می‌شود؟
